<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Tree Viz of Biolink</title>
    <style>
        h1,h2,h3,h4,h5,h6,footer {
          font-family: Helvetica,sans-serif;
        }
        a {
          text-decoration: none;
          color: #ff5500;
        }
        footer {
          font-size: 10px;
        }
        .node circle {
          fill: #b8b8b8;
          stroke: #b8b8b8;
          stroke-width: 0px;
        }
        .node text {
          font: 12px sans-serif;
          color: black;
        }
        .node--internal text {
          text-shadow: 0 1px 0 #fff, 0 -1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff;
        }
        .link {
          fill: none;
          stroke: #b8b8b8;
          stroke-width: 1px;
        }
    </style>
</head>
<body>
    <h2>Visualization of the Biolink Model</h2>
    <p>Tree visualizations of the category and predicate hierarchies in the <a href="https://biolink.github.io/biolink-model/" target="_blank">Biolink Model</a>.</p>
    <p>Displaying data for Biolink Model version <span style="font-weight:bold;">{{biolink_version}}</span>.
    View a different version by tacking on "/1.8.1" (or whatever version number) to this page's URL.</p>

    <div>
        <h3>Categories</h3>

<!--        Thank you to https://bl.ocks.org/d3noob/5537fe63086c4f100114f87f124850dd for the tree visualization code-->
        <!-- load the d3.js library -->
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>

        var treeData = {{categories|tojson}}
        var biolinkVersion = {{biolink_version|tojson}}

        // set the dimensions and margins of the diagram
        var margin = {top: 20, right: 90, bottom: 30, left: 90},
            width = 1300 - margin.left - margin.right,
            rawHeight = (biolinkVersion.startsWith("2") ? 700 : 900),
            height = rawHeight - margin.top - margin.bottom;

        // declares a tree layout and assigns the size
        var treemap = d3.tree()
            .size([height, width]);

        //  assigns the data to a hierarchy using parent-child relationships
        var nodes = d3.hierarchy(treeData, function(d) {
            return d.children;
          });

        // maps the node data to the tree layout
        nodes = treemap(nodes);

        // append the svg object to the body of the page
        // appends a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("body").append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom),
            g = svg.append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

        // adds the links between the nodes
        var link = g.selectAll(".link")
            .data( nodes.descendants().slice(1))
          .enter().append("path")
            .attr("class", "link")
            .attr("d", function(d) {
               return "M" + d.y + "," + d.x
                 + "C" + (d.y + d.parent.y) / 2 + "," + d.x
                 + " " + (d.y + d.parent.y) / 2 + "," + d.parent.x
                 + " " + d.parent.y + "," + d.parent.x;
               });

        // adds each node as a group
        var node = g.selectAll(".node")
            .data(nodes.descendants())
          .enter().append("g")
            .attr("class", function(d) {
              return "node" +
                (d.children ? " node--internal" : " node--leaf"); })
            .attr("transform", function(d) {
              return "translate(" + d.y + "," + d.x + ")"; });

        // adds the circle to the node
        node.append("circle")
          .attr("r", 4);

        // adds the text to the node
        node.append("text")
          .attr("dy", ".35em")
          .attr("x", function(d) { return d.children ? -7 : 7; })
          .style("text-anchor", function(d) {
            return d.children ? "end" : "start"; })
          .text(function(d) { return d.data.name; });

        </script>
    </div>


    <div>
        <h3>Predicates</h3>

<!--        Thank you to https://bl.ocks.org/d3noob/5537fe63086c4f100114f87f124850dd for the tree visualization code-->
        <!-- load the d3.js library -->
        <script src="https://d3js.org/d3.v4.min.js"></script>
        <script>

        var treeData = {{predicates|tojson}}
        var biolinkVersion = {{biolink_version|tojson}}

        // set the dimensions and margins of the diagram
        var margin = {top: 20, right: 90, bottom: 30, left: 90},
            width = 1200 - margin.left - margin.right,
            rawHeight = (biolinkVersion.startsWith("2") ? 2400 : 1800),
            height = rawHeight - margin.top - margin.bottom;

        // declares a tree layout and assigns the size
        var treemap = d3.tree()
            .size([height, width]);

        //  assigns the data to a hierarchy using parent-child relationships
        var nodes = d3.hierarchy(treeData, function(d) {
            return d.children;
          });

        // maps the node data to the tree layout
        nodes = treemap(nodes);

        // append the svg object to the body of the page
        // appends a 'group' element to 'svg'
        // moves the 'group' element to the top left margin
        var svg = d3.select("body").append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + margin.top + margin.bottom),
            g = svg.append("g")
              .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

        // adds the links between the nodes
        var link = g.selectAll(".link")
            .data( nodes.descendants().slice(1))
          .enter().append("path")
            .attr("class", "link")
            .attr("d", function(d) {
               return "M" + d.y + "," + d.x
                 + "C" + (d.y + d.parent.y) / 2 + "," + d.x
                 + " " + (d.y + d.parent.y) / 2 + "," + d.parent.x
                 + " " + d.parent.y + "," + d.parent.x;
               });

        // adds each node as a group
        var node = g.selectAll(".node")
            .data(nodes.descendants())
          .enter().append("g")
            .attr("class", function(d) {
              return "node" +
                (d.children ? " node--internal" : " node--leaf"); })
            .attr("transform", function(d) {
              return "translate(" + d.y + "," + d.x + ")"; });

        // adds the circle to the node
        node.append("circle")
          .attr("r", 4);

        // adds the text to the node
        node.append("text")
          .attr("dy", ".35em")
          .attr("x", function(d) { return d.children ? -7 : 7; })
          .style("text-anchor", function(d) {
            return d.children ? "end" : "start"; })
          .text(function(d) { return d.data.name; });

        </script>
    </div>

</body>
<footer>Author: <a href="https://github.com/amykglen" target="_blank">Amy Glen</a></footer>
</html>